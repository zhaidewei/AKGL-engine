# é¡¹ç›®æ€»è§ˆ

åç§°ï¼šMarketLag

**é¡¹ç›®ç›®æ ‡**ï¼š

> **åˆ©ç”¨å…¬å…±é«˜å¯ä¿¡ä¿¡æ¯æºï¼ˆRSS/æ–°é—»ï¼‰ä¸ Polymarket é¢„æµ‹å¸‚åœºä»·æ ¼ä¹‹é—´çš„æ—¶é—´å·®ï¼ˆinformation â†’ market latencyï¼‰ï¼Œåœ¨è¿‘å®æ—¶/å‡†å®æ—¶å±‚é¢è¯†åˆ«æ½œåœ¨çš„å¸‚åœºä½æ•ˆï¼ˆarbitrage / lag signalsï¼‰ã€‚**

æ³¨æ„ï¼š

* æˆ‘ä»¬åšçš„æ˜¯ **"æœºä¼šåˆ¤æ–­ / lag detection"**
* **ä¸æ˜¯è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ**ï¼ˆè¿™åœ¨åˆè§„ã€å·¥ç¨‹å¤æ‚åº¦ã€äº§å“å™äº‹ä¸Šéƒ½æ›´åˆç†ï¼‰

---

## ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹å‘ï¼ˆè€Œä¸æ˜¯æ™®é€š streaming demoï¼‰

### 1ï¸âƒ£ è¿™æ˜¯ä¸€ä¸ª **streaming-only çš„é—®é¢˜**

* Batch ETL åªèƒ½å›ç­”ï¼š

  * "è¿‡å»ä¸€å¤©å‘ç”Ÿäº†ä»€ä¹ˆ"
* ä½ è¦å›ç­”çš„æ˜¯ï¼š

  * **"ä¿¡æ¯åˆšåˆšå‡ºç°æ—¶ï¼Œå¸‚åœºæ˜¯å¦è¿˜æ²¡ååº”ï¼Ÿ"**

è¿™æ­£å¥½å‘½ä¸­ streaming çš„æ ¸å¿ƒä»·å€¼ï¼š

* event-time
* çª—å£
* çŠ¶æ€
* å»¶è¿Ÿï¼ˆlagï¼‰

---

### 2ï¸âƒ£ ä¿¡æ¯ä¸å¯¹ç§°æ˜¯çœŸå®å­˜åœ¨çš„

ç°å®ä¸–ç•Œçš„ä¼ æ’­é¡ºåºé€šå¸¸æ˜¯ï¼š

```
æƒå¨ä¿¡æ¯æºï¼ˆå®˜æ–¹ / é€šè®¯ç¤¾ /è®°è€…ï¼‰
â†’ ç¤¾äº¤/æ–°é—»æ‰©æ•£
â†’ é¢„æµ‹å¸‚åœºå½¢æˆå…±è¯†
```

è€Œ **Polymarket**ï¼š

* æ˜¯æ¦‚ç‡å…±è¯†çš„"ç»ˆç‚¹"
* ä½†ä¸æ˜¯ä¿¡æ¯çš„"èµ·ç‚¹"

**ä¸­é—´å­˜åœ¨å¯è¢«é‡åŒ–çš„æ—¶é—´å·®**ã€‚

---

### 3ï¸âƒ£ å…¬å…±æ•°æ® + é¢„æµ‹å¸‚åœº = ä½é—¨æ§› + é«˜ä»·å€¼

* ä¸ä¾èµ–ï¼š

  * ç§æœ‰æ•°æ®
  * å†…éƒ¨äº¤æ˜“ç³»ç»Ÿ
* ä½†ï¼š

  * æŠ€æœ¯æ·±åº¦é«˜
  * äº§å“å™äº‹ç¡¬
  * å¯å‡çº§ã€å¯å”®å–

---

## äºŒã€æˆ‘ä»¬æœ€ç»ˆé€‰å®šçš„"æœ€å°å¯è¡Œåœºæ™¯ï¼ˆMVPï¼‰"

### ğŸ¯ èšç„¦ä¸€ä¸ªé¢„æµ‹å¸‚åœº

* **ä¸»é¢˜**ï¼š1 æœˆä»½ç¾è”å‚¨æ˜¯å¦åŠ æ¯ï¼ˆFed hike in Januaryï¼‰
* **åˆ·æ–°é¢‘ç‡**ï¼š
  * **RSSäº‹ä»¶**ï¼šå®æ—¶/è¿‘å®æ—¶ï¼ˆæ¯15åˆ†é’Ÿè½®è¯¢ï¼Œé¿å…rate limitï¼‰
  * **Polymarketä»·æ ¼**ï¼šå°æ—¶çº§ï¼ˆæ•´ç‚¹æ‹‰å–ï¼‰
  * **Lagæ£€æµ‹**ï¼šæ¯å°æ—¶è®¡ç®—ä¸€æ¬¡ï¼ˆä½†åŸºäºå®æ—¶RSSæ•°æ®ï¼‰
* **ç›®æ ‡**ï¼š

  * åœ¨å·¥ç¨‹éš¾åº¦ä½çš„å‰æä¸‹
  * éªŒè¯"ä¿¡æ¯ â†’ å¸‚åœºååº”"æ˜¯å¦å­˜åœ¨å¯æ£€æµ‹çš„ lag

è¿™æ˜¯ä¸€ä¸ª**éå¸¸ç†æ€§çš„åˆ‡å£**ï¼š

* äº‹ä»¶é©±åŠ¨å¼º
* ä¿¡æ¯æºæ˜ç¡®
* å¸‚åœºå…³æ³¨åº¦é«˜
* ä¸éœ€è¦æ¯«ç§’çº§äº¤æ˜“

**æ³¨æ„**ï¼šRSSé‡‡ç”¨è¿‘å®æ—¶è½®è¯¢è€Œéå°æ—¶çº§ï¼Œå› ä¸ºç¾è”å‚¨ç›¸å…³æ–°é—»å¯èƒ½åœ¨ä»»æ„æ—¶é—´å‘å¸ƒï¼Œå¦‚æœåªåœ¨æ•´ç‚¹æ£€æŸ¥å¯èƒ½é”™è¿‡å…³é”®ä¿¡æ¯ã€‚

---

## ä¸‰ã€æ•°æ®æºé€‰æ‹©ä¸åŸå› 

### A. å…¬å…±ä¿¡æ¯æºï¼šRSS.appï¼ˆæ ¸å¿ƒä¿¡æ¯è¾“å…¥ï¼‰

#### ä¸ºä»€ä¹ˆä¸ç”¨ Twitterï¼Ÿ

* å®˜æ–¹ API æ˜‚è´µã€ä¸ç¨³å®š
* ç¬¬ä¸‰æ–¹ API æœ‰åˆè§„/æŒç»­æ€§é£é™©
* å¯¹ä½ è¿™ä¸ªé—®é¢˜æ¥è¯´ï¼š

  * **å™ªå£° > ä¿¡å·**

#### ä¸ºä»€ä¹ˆç”¨ RSSï¼Ÿ

* **æˆæœ¬ä½**ï¼ˆRSS.app ~$10/æœˆï¼‰
* **ä¿¡æ¯å¯†åº¦é«˜**
* **æ—¶é—´æˆ³æ¸…æ™°**
* éå¸¸é€‚åˆï¼š

  * äº‹ä»¶é©±åŠ¨
  * lag åˆ†æ

#### RSS.app çš„è§’è‰²

* èšåˆï¼š

  * Reuters
  * å…¶ä»–æƒå¨æ–°é—»æº
* ä½ ä¸å…³å¿ƒ"è°è®¨è®ºäº†"
* ä½ å…³å¿ƒï¼š

  > **"ä»€ä¹ˆæ—¶å€™å‡ºç°äº†å¯å½±å“å¸‚åœºé¢„æœŸçš„äº‹å®/è§£è¯»"**

---

### B. å¸‚åœºæ•°æ®æºï¼šPolymarketï¼ˆç»“æœä¸å…±è¯†ï¼‰

#### æˆ‘ä»¬ä½¿ç”¨çš„ Polymarket æ•°æ®ç±»å‹

1. **å¸‚åœºå…ƒæ•°æ®ï¼ˆä½é¢‘ï¼‰**

   * market slug
   * close time
   * YES / NO å¯¹åº”çš„ token_id

2. **ä»·æ ¼æ•°æ®ï¼ˆå°æ—¶çº§ï¼‰**

   * å½“å‰ YES / NO æ¦‚ç‡
   * é€šè¿‡ CLOB REST API æ‹‰å–

#### ä¸ºä»€ä¹ˆä¸ç”¨ WebSocketï¼ˆç°åœ¨ï¼‰

* å°æ—¶åˆ·æ–°å·²ç»è¶³å¤ŸéªŒè¯ lag
* REST è½®è¯¢ï¼š

  * å®ç°ç®€å•
  * ç¨³å®š
  * æ˜“ debug

WebSocket æ˜¯ **åç»­å‡çº§é¡¹**ï¼Œä¸æ˜¯ MVP å¿…éœ€ã€‚

---

## å››ã€æŠ€æœ¯æ ˆé€‰æ‹©

### æ•°æ®æ¥å…¥
- **Python 3.9+** (requests, kafka-python)
- æˆ–: Kafka Connect HTTP Source Connectorï¼ˆå¦‚æœå¯ç”¨ï¼‰

### æµå¤„ç†
- **Apache Flink 2.2.0**
- **Java 11+** (æ ¸å¿ƒé€»è¾‘ï¼Œç‰¹åˆ«æ˜¯å¤æ‚joinå’Œlagæ£€æµ‹)
- **Flink SQL** (ç®€å•èšåˆï¼Œå¦‚RSSå°æ—¶èšåˆ)
- PyFlink (å¯é€‰ï¼Œç”¨äºNLPå¤„ç†)

### æ¶ˆæ¯é˜Ÿåˆ—
- **Apache Kafka 3.x**
- æˆ–: Confluent Cloud (å¦‚æœä½¿ç”¨SaaS)

### å­˜å‚¨
- **PostgreSQL** (å†å²æ•°æ®æŒä¹…åŒ–)
- æˆ–: TimescaleDB (æ—¶åºæ•°æ®ä¼˜åŒ–)

### å¯è§†åŒ–
- **Grafana** (å®æ—¶dashboard)
- æˆ–: ç®€å•Web UI

---

## äº”ã€æ•´ä½“å·¥ç¨‹æ¶æ„

```
[RSS.app]                [Polymarket APIs]
    |                         |
    v                         v
Python Producers        Python Producers
(æ¯15åˆ†é’Ÿè½®è¯¢)          (æ¯å°æ—¶æ•´ç‚¹æ‹‰å–)
    |                         |
    v                         v
Kafka Cluster          Kafka Cluster
(rss.events)        (polymarket.price_hourly)
        \               /
         \             /
          v           v
            Apache Flink
      (event-time, window, state)
                 |
                 v
        lag / arbitrage signals
        (Kafka + PostgreSQL + Grafana)
```

**æ¶æ„è¯´æ˜**ï¼š
- æ•°æ®æ¥å…¥å±‚ï¼šPythonè„šæœ¬ä½œä¸ºKafka Producerï¼Œè´Ÿè´£ä»APIæ‹‰å–æ•°æ®å¹¶å†™å…¥Kafka
- Kafka Clusterï¼šå¯ä»¥æ˜¯è‡ªå»ºKafkaæˆ–äº‘æœåŠ¡ï¼ˆå¦‚Confluent Cloudï¼‰
- Flinkï¼šå¤„ç†æµæ•°æ®ï¼Œæ‰§è¡Œçª—å£èšåˆã€joinå’Œlagæ£€æµ‹
- è¾“å‡ºï¼šåŒæ—¶å†™å…¥Kafka topicï¼ˆå®æ—¶æµï¼‰å’ŒPostgreSQLï¼ˆæŒä¹…åŒ–ï¼‰

---

## å…­ã€æ•°æ®æ¥å…¥å±‚è®¾è®¡

### RSS.app æ¥å…¥

#### APIè°ƒç”¨
- **Endpoint**: `https://api.rss.app/v1/feeds/{feed_id}/items`
- **è®¤è¯**: API Key in header (`X-API-KEY`)
- **è½®è¯¢é¢‘ç‡**: æ¯15åˆ†é’Ÿï¼ˆé¿å…rate limitï¼‰
- **Rate Limit**: æ ¹æ®RSS.appæ–‡æ¡£è®¾ç½®ï¼ˆé€šå¸¸1000æ¬¡/å°æ—¶ï¼‰

#### æ•°æ®å¤„ç†
- **Schemaè½¬æ¢**: RSS item â†’ Kafka message
- **å»é‡ç­–ç•¥**: åŸºäº`published_at + title`çš„hashå€¼ï¼Œé¿å…é‡å¤å¤„ç†
- **å…³é”®è¯åŒ¹é…**: åœ¨æ¥å…¥å±‚è¿›è¡Œï¼Œæå–Fed/rate/hike/dovishç­‰å…³é”®è¯
- **æ•°æ®éªŒè¯**:
  - éªŒè¯`published_at`æ ¼å¼ï¼ˆISO 8601ï¼‰
  - éªŒè¯`title`éç©º
  - éªŒè¯`source`å­—æ®µå­˜åœ¨

#### é”™è¯¯å¤„ç†
- **é‡è¯•æœºåˆ¶**: å¤±è´¥åé‡è¯•3æ¬¡ï¼ŒæŒ‡æ•°é€€é¿
- **å¤±è´¥å¤„ç†**: è¶…è¿‡3æ¬¡å¤±è´¥åè®°å½•åˆ°dead letter queue
- **ç›‘æ§**: è®°å½•APIè°ƒç”¨æˆåŠŸç‡ã€å»¶è¿Ÿç­‰æŒ‡æ ‡

#### Kafkaæ¶ˆæ¯Schema
```json
{
  "title": "string",
  "published_at": "2026-01-07T10:15:00Z",
  "source": "reuters",
  "source_weight": 1.0,
  "keywords": ["Fed", "rate", "hike"],
  "keyword_scores": {"Fed": 2.0, "rate": 1.5, "hike": 2.0},
  "timezone": "UTC"
}
```

---

### Polymarket API æ¥å…¥

#### APIè°ƒç”¨
- **Market Metadata**: `GET /markets/{slug}` (ä½é¢‘ï¼Œå¯åŠ¨æ—¶æˆ–å¸‚åœºå˜æ›´æ—¶æ‹‰å–)
- **Price Data**: `GET /markets/{slug}/prices` (æ¯å°æ—¶æ•´ç‚¹æ‹‰å–)
- **è®¤è¯**: API Keyï¼ˆå¦‚æœéœ€è¦ï¼‰
- **Rate Limit**: æ ¹æ®Polymarketæ–‡æ¡£è®¾ç½®

#### æ•°æ®å¤„ç†
- **Schemaè½¬æ¢**: ç›´æ¥æ˜ å°„åˆ°Kafka message
- **æ•°æ®éªŒè¯**:
  - éªŒè¯`price âˆˆ [0,1]`èŒƒå›´
  - éªŒè¯`timestamp`æœ‰æ•ˆ
  - éªŒè¯`market_slug`å’Œ`outcome`å­—æ®µå­˜åœ¨
- **æ—¶åŒºå¤„ç†**: æ‰€æœ‰æ—¶é—´æˆ³ç»Ÿä¸€è½¬æ¢ä¸ºUTC

#### é”™è¯¯å¤„ç†
- **é‡è¯•æœºåˆ¶**: å¤±è´¥åé‡è¯•3æ¬¡
- **æ•°æ®ç¼ºå¤±å¤„ç†**: ä½¿ç”¨ä¸Šä¸€å°æ—¶çš„æ•°æ®ï¼ˆå¯¹äºä»·æ ¼æ•°æ®ï¼‰
- **å¼‚å¸¸å€¼å¤„ç†**: è®°å½•æ—¥å¿—ï¼Œä¸ä¸­æ–­å¤„ç†

#### Kafkaæ¶ˆæ¯Schema

**polymarket.market_meta** (ä½é¢‘):
```json
{
  "market_slug": "fed-hike-january-2026",
  "question": "Will the Fed raise rates in January 2026?",
  "close_time": "2026-01-31T23:59:59Z",
  "yes_token_id": "0x...",
  "no_token_id": "0x...",
  "timezone": "UTC"
}
```

**polymarket.price_hourly**:
```json
{
  "market_slug": "fed-hike-january-2026",
  "outcome": "YES",
  "price": 0.65,
  "event_time": "2026-01-07T10:00:00Z",
  "fetched_at": "2026-01-07T10:00:15Z",
  "timezone": "UTC"
}
```

---

## ä¸ƒã€Kafka Topic è®¾è®¡ï¼ˆæœ€å°ä½†å¯æ‰©å±•ï¼‰

### 1ï¸âƒ£ `rss.events`

* **Partition Key**: `source` (ç¡®ä¿åŒä¸€æ¥æºçš„æ¶ˆæ¯æœ‰åº)
* **Value Schema**: è§"æ•°æ®æ¥å…¥å±‚è®¾è®¡"ç« èŠ‚
* **Retention**: 7å¤©
* **Replication Factor**: 3 (ç”Ÿäº§ç¯å¢ƒ)

### 2ï¸âƒ£ `polymarket.market_meta`ï¼ˆä½é¢‘ï¼‰

* **Partition Key**: `market_slug`
* **Value Schema**: è§"æ•°æ®æ¥å…¥å±‚è®¾è®¡"ç« èŠ‚
* **Retention**: 30å¤©ï¼ˆå…ƒæ•°æ®å˜åŒ–é¢‘ç‡ä½ï¼‰
* **Replication Factor**: 3

### 3ï¸âƒ£ `polymarket.price_hourly`

* **Partition Key**: `market_slug|outcome` (å¦‚ "fed-hike-january-2026|YES")
* **Value Schema**: è§"æ•°æ®æ¥å…¥å±‚è®¾è®¡"ç« èŠ‚
* **Retention**: 7å¤©
* **Replication Factor**: 3

### 4ï¸âƒ£ `rss.signals_hourly` (ä¸­é—´Topicï¼ŒJob 1è¾“å‡º)

* **Partition Key**: `window_start` (å°æ—¶çª—å£å¼€å§‹æ—¶é—´)
* **Value Schema**:
```json
{
  "window_start": "2026-01-07T10:00:00Z",
  "window_end": "2026-01-07T11:00:00Z",
  "mention_count": 15,
  "keyword_score": 8.5,
  "source_weighted_signal": 7.2,
  "timezone": "UTC"
}
```

### 5ï¸âƒ£ `polymarket.price_normalized` (ä¸­é—´Topicï¼ŒJob 2è¾“å‡º)

* **Partition Key**: `market_slug|outcome`
* **Value Schema**:
```json
{
  "market_slug": "fed-hike-january-2026",
  "outcome": "YES",
  "price": 0.65,
  "price_delta": 0.02,
  "event_time": "2026-01-07T10:00:00Z",
  "prev_price": 0.63,
  "timezone": "UTC"
}
```

### 6ï¸âƒ£ `lag_signals` (æœ€ç»ˆè¾“å‡ºTopic)

* **Partition Key**: `market_slug|window_start`
* **Value Schema**: è§"Flink Jobè®¾è®¡"ç« èŠ‚
* **Retention**: 30å¤©
* **Replication Factor**: 3

---

## å…«ã€Flink Job è®¾è®¡

### æ•°æ®æµå…³ç³»

```
rss.events
    â†“ (Job 1: 1h tumbling window)
rss.signals_hourly
    â†“
    â”œâ”€â†’ (Job 3: Interval Join)
    â”‚
polymarket.price_hourly â”€â”€â†’ (Job 2: ä»·æ ¼æ ‡å‡†åŒ– + Î”è®¡ç®—)
    â†“
polymarket.price_normalized â”€â”€â†’ (Job 3: Interval Join)
    â†“
lag_signals (Kafka + PostgreSQL)
```

**è¯´æ˜**ï¼š
- Job 1å’ŒJob 2å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œäº’ä¸ä¾èµ–
- Job 3ä¾èµ–Job 1å’ŒJob 2çš„è¾“å‡ºï¼Œé€šè¿‡Interval Joinåˆå¹¶æ•°æ®æµ
- æ‰€æœ‰Jobå¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªFlink Applicationï¼Œä¹Ÿå¯ä»¥æ‹†åˆ†ä¸ºç‹¬ç«‹çš„Jobï¼ˆæ¨èåˆå¹¶ï¼Œå‡å°‘è¿ç»´å¤æ‚åº¦ï¼‰

---

### Job 1ï¼šRSS ä¿¡å·å°æ—¶èšåˆ

#### è®¾è®¡é€‰æ‹©
- **è¯­è¨€**: Flink SQL (Table API) - ç®€å•çª—å£èšåˆ
- **è¾“å…¥**: `rss.events` topic
- **è¾“å‡º**: `rss.signals_hourly` topic

#### å¤„ç†é€»è¾‘
- **çª—å£**: 1å°æ—¶ tumbling windowï¼ŒåŸºäº`published_at`çš„event time
- **Watermarkç­–ç•¥**: å…è®¸5åˆ†é’Ÿå»¶è¿Ÿ (`BoundedOutOfOrdernessTimestampExtractor`)
- **èšåˆè®¡ç®—**:
  - `mention_count`: COUNT(*)
  - `keyword_score`: SUM(keyword_weight Ã— occurrence_count)
    - å…³é”®è¯æƒé‡: Fed=2.0, rate=1.5, hike=2.0, dovish=-1.5 (è´Ÿå€¼è¡¨ç¤ºé™ä½æ¦‚ç‡)
  - `source_weighted_signal`: SUM(article_score Ã— source_weight) / COUNT(*)
    - æ¥æºæƒé‡: Reuters=1.0, Bloomberg=0.9, å…¶ä»–=0.7
    - article_score = SUM(keyword_scores)

#### é…ç½®
- **State**: ä¸éœ€è¦keyed stateï¼ˆçª—å£èšåˆè‡ªåŠ¨ç®¡ç†ï¼‰
- **å¹¶è¡Œåº¦**: 2-4 (æ ¹æ®æ•°æ®é‡è°ƒæ•´)
- **Checkpoint**: æ¯5åˆ†é’Ÿä¸€æ¬¡

---

### Job 2ï¼šå¸‚åœºä»·æ ¼æ ‡å‡†åŒ–å’Œå˜åŒ–è®¡ç®—

#### è®¾è®¡é€‰æ‹©
- **è¯­è¨€**: Flink SQL + Java ProcessFunction (éœ€è¦ä¿å­˜ä¸Šä¸€å°æ—¶ä»·æ ¼)
- **è¾“å…¥**: `polymarket.price_hourly` topic
- **è¾“å‡º**: `polymarket.price_normalized` topic

#### å¤„ç†é€»è¾‘
- **Keyed by**: `market_slug|outcome`
- **æ ‡å‡†åŒ–**: ç¡®ä¿price âˆˆ [0,1]ï¼ˆAPIè¿”å›çš„priceåº”è¯¥å·²ç»åœ¨è¿™ä¸ªèŒƒå›´ï¼‰
- **ä»·æ ¼å˜åŒ–è®¡ç®—**:
  - ä½¿ç”¨`ValueState`ä¿å­˜ä¸Šä¸€å°æ—¶çš„ä»·æ ¼
  - `price_delta = current_price - prev_price`
  - å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå°æ—¶ï¼Œ`price_delta = 0`

#### é…ç½®
- **State**: ValueState<Double> (ä¿å­˜ä¸Šä¸€å°æ—¶ä»·æ ¼)
- **State TTL**: 24å°æ—¶ï¼ˆé¿å…stateæ— é™å¢é•¿ï¼‰
- **Watermarkç­–ç•¥**: å…è®¸5åˆ†é’Ÿå»¶è¿Ÿ
- **å¹¶è¡Œåº¦**: 2-4
- **Checkpoint**: æ¯5åˆ†é’Ÿä¸€æ¬¡

---

### Job 3ï¼šLag / æœºä¼šåˆ¤æ–­ï¼ˆMVP è§„åˆ™ï¼‰

#### è®¾è®¡é€‰æ‹©
- **è¯­è¨€**: Java ProcessFunction - éœ€è¦å¤æ‚joiné€»è¾‘å’ŒçŠ¶æ€ç®¡ç†
- **è¾“å…¥**:
  - `rss.signals_hourly` (æ¥è‡ªJob 1)
  - `polymarket.price_normalized` (æ¥è‡ªJob 2)
- **è¾“å‡º**:
  - `lag_signals` topic (ä¸»è¦è¾“å‡º)
  - Side output for alerts (å¯é€‰)

#### å¤„ç†é€»è¾‘
- **Joinæ–¹å¼**: Interval Join (1å°æ—¶çª—å£)
  - RSS signalçš„çª—å£æ—¶é—´ä¸priceçš„event_timeå¯¹é½
  - Joinæ¡ä»¶: `rss.window_start = price.event_time` (å…è®¸Â±5åˆ†é’Ÿå®¹å·®)
- **Lagæ£€æµ‹è§„åˆ™**:
  > **å¦‚æœåœ¨ t å°æ—¶ï¼š**
  >
  > * RSS signalæ˜æ˜¾ä¸Šå‡: `signal_delta > 1.0` æˆ– `signal_delta > baselineçš„50%`
  > * ä½†Polymarket YES priceæœªå˜åŒ–/å˜åŒ–å¾ˆå°: `|price_delta| < 0.02` (2%)
  >
  > â‡’ æ ‡è®°ä¸º **potential lag window**

- **Confidenceè®¡ç®—**:
  ```
  confidence = f(signal_strength, price_stability, time_window)
  confidence = min(1.0,
    (signal_delta / max_signal_delta) * 0.5 +
    (1 - |price_delta|) * 0.3 +
    (source_weight_avg) * 0.2
  )
  ```
  - `max_signal_delta`: å†å²æœ€å¤§signal_deltaï¼ˆéœ€è¦Stateä¿å­˜ï¼‰
  - `source_weight_avg`: è¯¥çª—å£å†…RSSæ¥æºçš„å¹³å‡æƒé‡

#### è¾“å‡ºSchema
```json
{
  "market": "fed-hike-january-2026",
  "window": "2026-01-07T10:00:00Z",
  "signal_delta": 1.6,
  "price_delta": 0.00,
  "lag_flag": true,
  "confidence": 0.72,
  "rss_signal": 7.2,
  "prev_rss_signal": 5.6,
  "price": 0.65,
  "prev_price": 0.65,
  "detected_at": "2026-01-07T10:05:00Z",
  "timezone": "UTC"
}
```

#### é…ç½®
- **State**:
  - MapState<String, Double> (ä¿å­˜å†å²æœ€å¤§signal_deltaï¼Œkeyä¸ºmarket_slug)
  - State TTL: 7å¤©
- **å¹¶è¡Œåº¦**: 2-4
- **Checkpoint**: æ¯5åˆ†é’Ÿä¸€æ¬¡
- **Side Output**: é«˜confidence (>0.8)çš„ä¿¡å·è¾“å‡ºåˆ°alerts topic

---

### å…³é”®æŒ‡æ ‡å®šä¹‰

#### keyword_score
```
keyword_score = sum(keyword_weight Ã— occurrence_count) for each keyword
```
- å…³é”®è¯æƒé‡ç¤ºä¾‹: Fed=2.0, rate=1.5, hike=2.0, dovish=-1.5 (è´Ÿå€¼è¡¨ç¤ºé™ä½æ¦‚ç‡)

#### source_weighted_signal
```
source_weighted_signal = sum(article_score Ã— source_weight) / count
```
- æ¥æºæƒé‡: Reuters=1.0, Bloomberg=0.9, å…¶ä»–=0.7
- article_score = SUM(keyword_scores for that article)

#### signal_delta
```
signal_delta = current_hour.source_weighted_signal - prev_hour.source_weighted_signal
```

#### æ˜æ˜¾ä¸Šå‡é˜ˆå€¼
- `signal_delta > 1.0` (ç»å¯¹é˜ˆå€¼)
- æˆ– `signal_delta > baselineçš„50%` (ç›¸å¯¹é˜ˆå€¼ï¼Œbaselineä¸ºè¿‡å»24å°æ—¶å¹³å‡å€¼)

#### å˜åŒ–å¾ˆå°é˜ˆå€¼
- `|price_delta| < 0.02` (2%)

#### confidence
è§Job 3çš„confidenceè®¡ç®—å…¬å¼

---

## ä¹ã€æ—¶åŒºå¤„ç†ç­–ç•¥

### ç»Ÿä¸€æ—¶åŒº
- **æ‰€æœ‰æ—¶é—´æˆ³ç»Ÿä¸€è½¬æ¢ä¸ºUTC**
- **å°æ—¶å¯¹é½åŸºäºUTCæ—¶é—´**
- **åœ¨Kafka messageä¸­æ˜ç¡®æ ‡æ³¨timezoneå­—æ®µä¸º"UTC"**

### å®ç°ç»†èŠ‚
- RSSæ¥å…¥å±‚: å°†`published_at`è½¬æ¢ä¸ºUTCï¼ˆå¦‚æœæºæ•°æ®æ˜¯å…¶ä»–æ—¶åŒºï¼‰
- Polymarketæ¥å…¥å±‚: å°†`event_time`å’Œ`fetched_at`è½¬æ¢ä¸ºUTC
- Flinkå¤„ç†: æ‰€æœ‰çª—å£å’Œjoinæ“ä½œåŸºäºUTCæ—¶é—´
- è¾“å‡º: æ‰€æœ‰è¾“å‡ºæ—¶é—´æˆ³å‡ä¸ºUTCæ ¼å¼

### ç¤ºä¾‹
```
RSS published_at: "2026-01-07T10:15:00-05:00" (EST)
â†’ è½¬æ¢ä¸º: "2026-01-07T15:15:00Z" (UTC)
â†’ å¯¹é½åˆ°å°æ—¶çª—å£: "2026-01-07T15:00:00Z"
```

---

## åã€è¾“å‡ºå’Œå­˜å‚¨è®¾è®¡

### è¾“å‡ºç›®æ ‡

#### 1. Kafka Topic: `lag_signals` (å®æ—¶æµ)
- **ç”¨é€”**: å®æ—¶æµå¼è¾“å‡ºï¼Œä¾›ä¸‹æ¸¸ç³»ç»Ÿæ¶ˆè´¹
- **æ¶ˆè´¹è€…**: Grafana (å®æ—¶å¯è§†åŒ–), å‘Šè­¦ç³»ç»Ÿ
- **Retention**: 30å¤©

#### 2. PostgreSQLè¡¨: `lag_signals_history` (æŒä¹…åŒ–)
- **ç”¨é€”**: å†å²æ•°æ®æŒä¹…åŒ–ï¼Œç”¨äºåˆ†æå’Œå›æµ‹
- **Schema**:
```sql
CREATE TABLE lag_signals_history (
    id SERIAL PRIMARY KEY,
    market VARCHAR(100) NOT NULL,
    window TIMESTAMP NOT NULL,
    signal_delta DECIMAL(10, 4),
    price_delta DECIMAL(10, 4),
    lag_flag BOOLEAN,
    confidence DECIMAL(3, 2),
    rss_signal DECIMAL(10, 4),
    prev_rss_signal DECIMAL(10, 4),
    price DECIMAL(5, 4),
    prev_price DECIMAL(5, 4),
    detected_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    INDEX idx_market_window (market, window),
    INDEX idx_detected_at (detected_at)
);
```
- **å†™å…¥æ–¹å¼**: Flink JDBC Sink
- **æ•°æ®ä¿ç•™**: 90å¤©ï¼ˆå¯é…ç½®ï¼‰

#### 3. Grafana Dashboard (å¯è§†åŒ–)
- **å®æ—¶æŒ‡æ ‡**:
  - Lagä¿¡å·æ•°é‡ï¼ˆæŒ‰å°æ—¶ï¼‰
  - Confidenceåˆ†å¸ƒ
  - Signal delta vs Price deltaæ•£ç‚¹å›¾
  - æ—¶é—´åºåˆ—ï¼šRSS signalå’ŒPriceå˜åŒ–
- **å†å²åˆ†æ**:
  - False positive rate
  - ä¿¡å·å‡†ç¡®æ€§è¶‹åŠ¿

---

### æ•°æ®ä¿ç•™ç­–ç•¥
- **Kafka Topics**: 7-30å¤©ï¼ˆæ ¹æ®topicé‡è¦æ€§ï¼‰
- **PostgreSQL**: 90å¤©ï¼ˆå¯é…ç½®ï¼Œæ”¯æŒå†å²åˆ†æï¼‰
- **Grafana**: ä¾èµ–PostgreSQLæ•°æ®æº

---

## åä¸€ã€æ•°æ®è´¨é‡ä¿éšœ

### æ•°æ®éªŒè¯

#### RSSæ•°æ®éªŒè¯
- éªŒè¯`published_at`æ ¼å¼ï¼ˆISO 8601ï¼‰
- éªŒè¯`title`éç©º
- éªŒè¯`source`å­—æ®µå­˜åœ¨ä¸”æœ‰æ•ˆ
- éªŒè¯`keywords`æ•°ç»„æ ¼å¼æ­£ç¡®

#### Polymarketæ•°æ®éªŒè¯
- éªŒè¯`price âˆˆ [0,1]`èŒƒå›´
- éªŒè¯`timestamp`æœ‰æ•ˆï¼ˆä¸èƒ½æ˜¯æœªæ¥æ—¶é—´ï¼‰
- éªŒè¯`market_slug`å’Œ`outcome`å­—æ®µå­˜åœ¨
- éªŒè¯`price_delta`è®¡ç®—æ­£ç¡®ï¼ˆå¦‚æœå·²è®¡ç®—ï¼‰

### å¼‚å¸¸å¤„ç†

#### APIå¤±è´¥å¤„ç†
- **é‡è¯•æœºåˆ¶**: å¤±è´¥åé‡è¯•3æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼ˆ1s, 2s, 4sï¼‰
- **å¤±è´¥åå¤„ç†**: è¶…è¿‡3æ¬¡å¤±è´¥åè®°å½•åˆ°dead letter queue (Kafka topic: `dlq.rss.events` æˆ– `dlq.polymarket.price_hourly`)
- **ç›‘æ§å‘Šè­¦**: APIå¤±è´¥ç‡ > 10%æ—¶è§¦å‘å‘Šè­¦

#### æ•°æ®ç¼ºå¤±å¤„ç†
- **ä»·æ ¼æ•°æ®ç¼ºå¤±**: ä½¿ç”¨ä¸Šä¸€å°æ—¶çš„æ•°æ®ï¼ˆé€šè¿‡Flink Stateå®ç°ï¼‰
- **RSSæ•°æ®ç¼ºå¤±**: è·³è¿‡è¯¥å°æ—¶çª—å£ï¼ˆä¸è¾“å‡ºsignalï¼Œä½†è®°å½•æ—¥å¿—ï¼‰
- **Joinå¤±è´¥**: å¦‚æœRSSæˆ–Priceæ•°æ®ç¼ºå¤±å¯¼è‡´æ— æ³•joinï¼Œè®°å½•åˆ°side output

#### å¼‚å¸¸å€¼å¤„ç†
- **ä»·æ ¼è¶…å‡ºèŒƒå›´**: è®°å½•æ—¥å¿—ï¼Œä¸ä¸­æ–­å¤„ç†ï¼Œä½¿ç”¨clampåˆ°[0,1]
- **æ—¶é—´æˆ³å¼‚å¸¸**: è®°å½•æ—¥å¿—ï¼Œä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºfallback
- **è®¡ç®—å¼‚å¸¸**: è®°å½•æ—¥å¿—ï¼Œè¾“å‡ºconfidence=0çš„lagä¿¡å·

### SchemaéªŒè¯
- ä½¿ç”¨Kafka Schema Registryï¼ˆå¦‚æœå¯ç”¨ï¼‰æˆ–è‡ªå®šä¹‰éªŒè¯
- Flinkä¾§ä½¿ç”¨Flink SQLçš„ç±»å‹ç³»ç»Ÿè¿›è¡ŒéªŒè¯

---

## åäºŒã€ç›‘æ§å’Œè¿ç»´

### å…³é”®æŒ‡æ ‡

#### FlinkæŒ‡æ ‡
- **CheckpointæˆåŠŸç‡**: ç›®æ ‡ > 99%
- **Checkpointæ—¶é•¿**: ç›®æ ‡ < 30ç§’
- **èƒŒå‹ï¼ˆBackpressureï¼‰**: ç›‘æ§å„operatorçš„èƒŒå‹æƒ…å†µ
- **State Size**: ç›‘æ§å„Jobçš„stateå¤§å°ï¼Œé¿å…OOM
- **Watermarkå»¶è¿Ÿ**: ç›‘æ§event timeå’Œprocessing timeçš„å·®è·
- **Throughput**: æ¯ç§’å¤„ç†çš„æ¶ˆæ¯æ•°

#### KafkaæŒ‡æ ‡
- **Consumer Lag**: å„consumer groupçš„lagï¼Œç›®æ ‡ < 1å°æ—¶
- **Throughput**: å„topicçš„å†™å…¥å’Œè¯»å–é€Ÿç‡
- **Partitionåˆ†å¸ƒ**: ç¡®ä¿æ•°æ®åˆ†å¸ƒå‡åŒ€

#### ä¸šåŠ¡æŒ‡æ ‡
- **Lagä¿¡å·æ•°é‡**: æ¯å°æ—¶æ£€æµ‹åˆ°çš„lagä¿¡å·æ•°
- **False Positive Rate**: éœ€è¦äººå·¥æ ‡è®°éªŒè¯
- **æ•°æ®æºå¥åº·åº¦**: RSSå’ŒPolymarket APIçš„å¯ç”¨æ€§
- **ç«¯åˆ°ç«¯å»¶è¿Ÿ**: ä»RSSå‘å¸ƒåˆ°lagä¿¡å·è¾“å‡ºçš„æ—¶é—´

### å‘Šè­¦ç­–ç•¥

#### é«˜ä¼˜å…ˆçº§å‘Šè­¦ï¼ˆç«‹å³å¤„ç†ï¼‰
- Flink jobå¤±è´¥æˆ–é‡å¯
- Kafka consumer lag > 1å°æ—¶
- Checkpointå¤±è´¥ç‡ > 5%
- æ•°æ®æºAPIè¿ç»­å¤±è´¥ > 3æ¬¡

#### ä¸­ä¼˜å…ˆçº§å‘Šè­¦ï¼ˆ1å°æ—¶å†…å¤„ç†ï¼‰
- èƒŒå‹æŒç»­ > 10åˆ†é’Ÿ
- State sizeå¢é•¿å¼‚å¸¸
- Watermarkå»¶è¿Ÿ > 10åˆ†é’Ÿ
- Lagä¿¡å·æ•°é‡å¼‚å¸¸ï¼ˆçªç„¶ä¸º0æˆ–çªç„¶æ¿€å¢ï¼‰

#### ä½ä¼˜å…ˆçº§å‘Šè­¦ï¼ˆ24å°æ—¶å†…å¤„ç†ï¼‰
- APIå¤±è´¥ç‡ > 10%
- æ•°æ®è´¨é‡æŒ‡æ ‡ä¸‹é™
- æ€§èƒ½æŒ‡æ ‡å¼‚å¸¸ï¼ˆä½†ä¸å½±å“åŠŸèƒ½ï¼‰

### æ•…éšœæ¢å¤ç­–ç•¥

#### Flink Jobæ•…éšœ
- **è‡ªåŠ¨æ¢å¤**: å¯ç”¨Flinkçš„è‡ªåŠ¨é‡å¯ç­–ç•¥ï¼ˆfixed delayï¼Œæœ€å¤š3æ¬¡ï¼‰
- **Stateæ¢å¤**: ä»æœ€æ–°checkpointæ¢å¤
- **æ‰‹åŠ¨æ¢å¤**: å¦‚æœè‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œæ‰‹åŠ¨ä»checkpointæ¢å¤

#### Kafkaæ•…éšœ
- **Brokeræ•…éšœ**: Kafkaè‡ªåŠ¨failoverï¼ˆéœ€è¦è‡³å°‘3ä¸ªbrokerï¼‰
- **æ•°æ®ä¸¢å¤±**: ä»checkpointæ¢å¤ï¼Œé‡æ–°å¤„ç†æ•°æ®

#### æ•°æ®æºæ•…éšœ
- **RSS.appæ•…éšœ**: è®°å½•åˆ°dead letter queueï¼Œç­‰å¾…æ¢å¤åé‡è¯•
- **Polymarket APIæ•…éšœ**: ä½¿ç”¨ä¸Šä¸€å°æ—¶æ•°æ®ï¼Œè®°å½•å‘Šè­¦

---

## åä¸‰ã€æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ•°æ®

#### å†å²æ•°æ®å›æ”¾
- ä½¿ç”¨å†å²RSSæ•°æ®å’ŒPolymarketä»·æ ¼æ•°æ®
- æ„é€ å·²çŸ¥çš„lagåœºæ™¯ï¼ˆå·²çŸ¥ä¿¡æ¯å‘å¸ƒä½†ä»·æ ¼æœªå˜åŒ–çš„æ—¶é—´ç‚¹ï¼‰
- éªŒè¯lag detectionçš„å‡†ç¡®æ€§

#### äººå·¥æ„é€ æµ‹è¯•æ•°æ®
- æ„é€ RSS signalä¸Šå‡ä½†priceä¸å˜çš„åœºæ™¯
- æ„é€ RSS signalä¸å˜ä½†priceå˜åŒ–çš„åœºæ™¯ï¼ˆéªŒè¯ä¸ä¼šè¯¯æŠ¥ï¼‰
- æ„é€ è¾¹ç•Œæƒ…å†µï¼ˆsignal_deltaåˆšå¥½åœ¨é˜ˆå€¼é™„è¿‘ï¼‰

### æµ‹è¯•æ–¹æ³•

#### å•å…ƒæµ‹è¯•
- **æ•°æ®æ¥å…¥å±‚**: Mock APIå“åº”ï¼Œæµ‹è¯•æ•°æ®è½¬æ¢å’ŒéªŒè¯é€»è¾‘
- **Flink Operators**: ä½¿ç”¨Flinkæµ‹è¯•å·¥å…·ï¼Œæµ‹è¯•å•ä¸ªoperatorçš„é€»è¾‘
- **æŒ‡æ ‡è®¡ç®—**: æµ‹è¯•keyword_scoreã€source_weighted_signalç­‰è®¡ç®—å‡½æ•°

#### é›†æˆæµ‹è¯•
- **æœ¬åœ°Flinkç¯å¢ƒ**: ä½¿ç”¨LocalEnvironmentï¼Œæµ‹è¯•å®Œæ•´çš„Jobæµç¨‹
- **Embedded Kafka**: ä½¿ç”¨embedded Kafkaï¼Œæµ‹è¯•ç«¯åˆ°ç«¯æ•°æ®æµ
- **Mockæ•°æ®æº**: ä½¿ç”¨å¯æ§çš„æ•°æ®æºï¼ŒéªŒè¯å„ç§åœºæ™¯

#### å‡†ç¡®æ€§éªŒè¯
- **å·²çŸ¥äº‹ä»¶å¯¹æ¯”**: å¯¹æ¯”å·²çŸ¥çš„lagäº‹ä»¶ï¼ˆå¦‚å†å²æ–°é—»å‘å¸ƒåå¸‚åœºååº”å»¶è¿Ÿï¼‰
- **False Positiveåˆ†æ**: åˆ†æè¯¯æŠ¥çš„lagä¿¡å·ï¼Œä¼˜åŒ–é˜ˆå€¼
- **Confidenceæ ¡å‡†**: éªŒè¯confidence scoreä¸å®é™…å‡†ç¡®æ€§çš„ç›¸å…³æ€§

### æµ‹è¯•ç¯å¢ƒ
- **å¼€å‘ç¯å¢ƒ**: æœ¬åœ°Flink + æœ¬åœ°Kafka
- **æµ‹è¯•ç¯å¢ƒ**: å°è§„æ¨¡é›†ç¾¤ï¼Œä½¿ç”¨çœŸå®APIï¼ˆä½†é¢‘ç‡é™ä½ï¼‰
- **ç”Ÿäº§ç¯å¢ƒ**: å®Œæ•´ç›‘æ§å’Œå‘Šè­¦

---

## åå››ã€å¼€å‘è®¡åˆ’ï¼ˆ4å‘¨ï¼‰

### Week 1: æ•°æ®æ¥å…¥å±‚
- **Day 1-2**: RSS.app APIé›†æˆ
  - APIè°ƒç”¨å®ç°
  - æ•°æ®è½¬æ¢å’ŒéªŒè¯
  - å…³é”®è¯åŒ¹é…é€»è¾‘
- **Day 3-4**: Polymarket APIé›†æˆ
  - Market metadataæ‹‰å–
  - Price dataæ‹‰å–
  - æ•°æ®è½¬æ¢å’ŒéªŒè¯
- **Day 5**: Kafka producerså®ç°
  - Produceré…ç½®
  - Schemaå®šä¹‰
  - é”™è¯¯å¤„ç†å’Œé‡è¯•
- **Day 6-7**: æ•°æ®éªŒè¯å’Œæµ‹è¯•
  - å•å…ƒæµ‹è¯•
  - é›†æˆæµ‹è¯•
  - æ•°æ®è´¨é‡éªŒè¯

### Week 2: Flink Jobå¼€å‘
- **Day 1-2**: Job 1 - RSSèšåˆ
  - Flink SQLå®ç°
  - Watermarké…ç½®
  - çª—å£èšåˆé€»è¾‘
- **Day 3-4**: Job 2 - ä»·æ ¼å¤„ç†
  - ä»·æ ¼æ ‡å‡†åŒ–
  - Stateç®¡ç†ï¼ˆä¸Šä¸€å°æ—¶ä»·æ ¼ï¼‰
  - Price deltaè®¡ç®—
- **Day 5-6**: æœ¬åœ°æµ‹è¯•
  - LocalEnvironmentæµ‹è¯•
  - æµ‹è¯•æ•°æ®æ„é€ 
  - éªŒè¯è¾“å‡ºæ­£ç¡®æ€§
- **Day 7**: ä¸­é—´TopicéªŒè¯
  - éªŒè¯Job 1å’ŒJob 2çš„è¾“å‡º
  - æ•°æ®æ ¼å¼æ£€æŸ¥

### Week 3: Lagæ£€æµ‹å’Œé›†æˆ
- **Day 1-3**: Job 3 - Lagæ£€æµ‹é€»è¾‘
  - Interval Joinå®ç°
  - Lagæ£€æµ‹è§„åˆ™
  - Confidenceè®¡ç®—
  - Stateç®¡ç†
- **Day 4-5**: ç«¯åˆ°ç«¯æµ‹è¯•
  - å®Œæ•´æ•°æ®æµæµ‹è¯•
  - å·²çŸ¥äº‹ä»¶éªŒè¯
  - è¾¹ç•Œæƒ…å†µæµ‹è¯•
- **Day 6-7**: å‡†ç¡®æ€§éªŒè¯
  - å†å²æ•°æ®å›æ”¾
  - False positiveåˆ†æ
  - é˜ˆå€¼è°ƒä¼˜

### Week 4: å®Œå–„å’Œæ–‡æ¡£
- **Day 1-2**: è¾“å‡ºå’Œå­˜å‚¨
  - PostgreSQLé›†æˆ
  - Grafana Dashboard
  - æ•°æ®ä¿ç•™ç­–ç•¥
- **Day 3**: ç›‘æ§å’Œå‘Šè­¦
  - æŒ‡æ ‡æ”¶é›†
  - å‘Šè­¦é…ç½®
  - ç›‘æ§Dashboard
- **Day 4**: æ•°æ®è´¨é‡ä¿éšœ
  - å¼‚å¸¸å¤„ç†å®Œå–„
  - Dead letter queue
  - æ•°æ®éªŒè¯å¢å¼º
- **Day 5-6**: æ–‡æ¡£å’Œæ¼”ç¤ºå‡†å¤‡
  - æŠ€æœ¯æ–‡æ¡£
  - ç”¨æˆ·æ–‡æ¡£
  - æ¼”ç¤ºè„šæœ¬
- **Day 7**: æœ€ç»ˆæµ‹è¯•å’Œä¼˜åŒ–
  - æ€§èƒ½æµ‹è¯•
  - å‹åŠ›æµ‹è¯•
  - ä¼˜åŒ–è°ƒæ•´

---

## åäº”ã€é£é™©è¯„ä¼°

### æŠ€æœ¯é£é™©

#### Polymarket APIå˜æ›´
- **é£é™©**: API endpointæˆ–schemaå˜æ›´å¯¼è‡´é›†æˆå¤±è´¥
- **å½±å“**: é«˜
- **ç¼“è§£æªæ–½**:
  - å®ç°é€‚é…å±‚ï¼Œå°è£…APIè°ƒç”¨
  - ç‰ˆæœ¬åŒ–API client
  - ç›‘æ§APIå“åº”æ ¼å¼å˜åŒ–

#### RSS.appæœåŠ¡ä¸­æ–­
- **é£é™©**: RSS.appæœåŠ¡ä¸å¯ç”¨ï¼Œå¯¼è‡´æ•°æ®æºä¸­æ–­
- **å½±å“**: ä¸­
- **ç¼“è§£æªæ–½**:
  - å®ç°å¤‡ç”¨æ•°æ®æºï¼ˆå¦‚ç›´æ¥RSS feedï¼‰
  - é‡è¯•æœºåˆ¶å’Œå‘Šè­¦
  - æ•°æ®ç¼ºå¤±æ—¶çš„é™çº§å¤„ç†

#### Flink Stateè¿‡å¤§
- **é£é™©**: State sizeå¢é•¿å¯¼è‡´OOMæˆ–æ€§èƒ½ä¸‹é™
- **å½±å“**: ä¸­
- **ç¼“è§£æªæ–½**:
  - è®¾ç½®State TTLï¼ˆ24å°æ—¶-7å¤©ï¼‰
  - å®šæœŸæ¸…ç†è¿‡æœŸstate
  - ç›‘æ§state sizeå¢é•¿è¶‹åŠ¿

#### æ•°æ®è´¨é‡é—®é¢˜
- **é£é™©**: å¼‚å¸¸æ•°æ®å¯¼è‡´è®¡ç®—é”™è¯¯æˆ–ç³»ç»Ÿå´©æºƒ
- **å½±å“**: ä¸­
- **ç¼“è§£æªæ–½**:
  - å®Œå–„æ•°æ®éªŒè¯
  - å¼‚å¸¸å€¼å¤„ç†
  - Dead letter queue

### ä¸šåŠ¡é£é™©

#### Lagä¿¡å·ä¸å‡†ç¡®ï¼ˆFalse Positiveï¼‰
- **é£é™©**: æ£€æµ‹åˆ°çš„lagä¿¡å·å®é™…ä¸Šä¸æ˜¯çœŸæ­£çš„å¸‚åœºä½æ•ˆ
- **å½±å“**: é«˜ï¼ˆå½±å“äº§å“å¯ä¿¡åº¦ï¼‰
- **ç¼“è§£æªæ–½**:
  - å®ç°confidence score
  - è®°å½•æ‰€æœ‰ä¿¡å·ä¾›åç»­åˆ†æ
  - å»ºç«‹åé¦ˆæœºåˆ¶ï¼ˆæ ‡è®°ä¿¡å·å‡†ç¡®æ€§ï¼‰
  - æŒç»­ä¼˜åŒ–é˜ˆå€¼å’Œè§„åˆ™

#### å¸‚åœºå·²ç»ååº”ï¼ˆFalse Negativeï¼‰
- **é£é™©**: çœŸæ­£çš„lagå­˜åœ¨ä½†æœªè¢«æ£€æµ‹åˆ°
- **å½±å“**: ä¸­ï¼ˆé”™è¿‡æœºä¼šï¼‰
- **ç¼“è§£æªæ–½**:
  - é™ä½æ£€æµ‹é˜ˆå€¼ï¼ˆä½†ä¼šå¢åŠ false positiveï¼‰
  - å¤šç»´åº¦ä¿¡å·åˆ†æ
  - äººå·¥reviewæœºåˆ¶

#### éœ€è¦äººå·¥éªŒè¯
- **é£é™©**: ç³»ç»Ÿæ£€æµ‹åˆ°ä¿¡å·ï¼Œä½†éœ€è¦äººå·¥éªŒè¯å…¶æœ‰æ•ˆæ€§
- **å½±å“**: ä½ï¼ˆè¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼‰
- **ç¼“è§£æªæ–½**:
  - æä¾›æ¸…æ™°çš„ä¿¡å·å±•ç¤ºç•Œé¢
  - è®°å½•ä¿¡å·ä¸Šä¸‹æ–‡ï¼ˆç›¸å…³RSSæ–‡ç« ã€ä»·æ ¼å†å²ç­‰ï¼‰
  - å»ºç«‹åé¦ˆå¾ªç¯ï¼ŒæŒç»­æ”¹è¿›

### ç¼“è§£æªæ–½æ€»ç»“
- **æŠ€æœ¯å±‚é¢**: é€‚é…å±‚ã€é‡è¯•æœºåˆ¶ã€State TTLã€æ•°æ®éªŒè¯
- **ä¸šåŠ¡å±‚é¢**: Confidence scoreã€åé¦ˆæœºåˆ¶ã€é˜ˆå€¼ä¼˜åŒ–
- **è¿ç»´å±‚é¢**: ç›‘æ§å‘Šè­¦ã€æ•…éšœæ¢å¤ã€æ•°æ®è´¨é‡ä¿éšœ

---

## åå…­ã€ä¸ºä»€ä¹ˆè¿™ä¸ªè®¾è®¡"å·¥ç¨‹éš¾åº¦ä½ä½†ä¸Šé™å¾ˆé«˜"

### ç°åœ¨çš„ä¼˜ç‚¹

* ä¸ä¾èµ–æ˜‚è´µ API
* ä¸æ¶‰åŠäº¤æ˜“æ‰§è¡Œ
* Flink èƒ½åŠ›å±•ç¤ºéå¸¸çº¯ç²¹ï¼š

  * event time
  * window
  * state
  * join
* Demo è§£é‡Šæ€§æå¼º
* **æŠ€æœ¯ç»†èŠ‚å®Œæ•´ï¼Œå¯ç›´æ¥å¼€å§‹å¼€å‘**

### åç»­å¯å‡çº§è·¯å¾„ï¼ˆæˆ‘ä»¬å·²ç»é¢„ç•™ï¼‰

1. **å®æ—¶æ€§å‡çº§**: å°æ—¶ â†’ 5 åˆ†é’Ÿ â†’ WebSocket
2. **æ•°æ®æºæ‰©å±•**: RSS â†’ RSS + ç¤¾äº¤ï¼ˆTwitter/Xï¼‰
3. **ç®—æ³•å‡çº§**: ç®€å•è§„åˆ™ â†’ CEP / ç»Ÿè®¡æ¨¡å‹ / æœºå™¨å­¦ä¹ 
4. **å¤šå¸‚åœºæ”¯æŒ**: å•å¸‚åœº â†’ å¤šå¸‚åœºï¼ˆé…ç½®é©±åŠ¨ï¼‰
5. **ä¿¡å·æºæ‰©å±•**: Off-chain â†’ Web3 signal è®¢é˜…
6. **æ€§èƒ½ä¼˜åŒ–**: å•æœº â†’ é›†ç¾¤ï¼Œå¢åŠ å¹¶è¡Œåº¦
7. **å­˜å‚¨å‡çº§**: PostgreSQL â†’ TimescaleDB / ClickHouse

---

## åä¸ƒã€è¿™ä¸ªé¡¹ç›®"åœ¨ä½ èŒä¸šè½¬å‹ä¸­çš„å®šä½"

è¿™ä¸æ˜¯ä¸€ä¸ªï¼š

* æ•™ç¨‹é¡¹ç›®
* ç©å…· demo
* ç®€å•æ•°æ®ç®¡é“

è¿™æ˜¯ä¸€ä¸ªï¼š

> **"é¢å‘çœŸå®å¸‚åœºä½æ•ˆé—®é¢˜çš„ streaming ä¿¡æ¯ç³»ç»Ÿ"**

å®ƒèƒ½å¤Ÿéå¸¸è‡ªç„¶åœ°è¯æ˜ï¼š

* ä½ ç†è§£ streaming çš„ **æœ¬è´¨**
* ä½ èƒ½åš **äº§å“çº§æ¶æ„å–èˆ**
* ä½ èƒ½åœ¨ **æˆæœ¬ã€å·¥ç¨‹ã€ä»·å€¼**ä¹‹é—´åšåˆ¤æ–­
* ä½ å…·å¤‡ **å®Œæ•´çš„å·¥ç¨‹èƒ½åŠ›**ï¼ˆä»æ•°æ®æ¥å…¥åˆ°ç›‘æ§è¿ç»´ï¼‰
* ä½ èƒ½å¤„ç† **çœŸå®ä¸–ç•Œçš„å¤æ‚æ€§**ï¼ˆæ•°æ®è´¨é‡ã€å¼‚å¸¸å¤„ç†ã€æ—¶åŒºç­‰ï¼‰

---

## é™„å½•ï¼šå…³é”®é…ç½®ç¤ºä¾‹

### Flink Checkpointé…ç½®
```java
env.enableCheckpointing(300000); // 5åˆ†é’Ÿ
env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);
env.getCheckpointConfig().setMinPauseBetweenCheckpoints(60000);
env.getCheckpointConfig().setCheckpointTimeout(600000);
env.getCheckpointConfig().setMaxConcurrentCheckpoints(1);
```

### Kafka Produceré…ç½®
```python
{
    'bootstrap.servers': 'localhost:9092',
    'acks': 'all',
    'retries': 3,
    'max.in.flight.requests.per.connection': 1,
    'enable.idempotence': True
}
```

### Watermarké…ç½®
```java
WatermarkStrategy
    .<Event>forBoundedOutOfOrderness(Duration.ofMinutes(5))
    .withTimestampAssigner((event, timestamp) -> event.getPublishedAt())
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2026-01-07
**åŸºäºReviewæŠ¥å‘Š**: review_report.md

