# Confluent Cloud 概述

**Learning Point**: 6.1 from knowledge_and_skills_needed_v2.md
**Prerequisites**: Understanding of managed cloud services, Kafka basics
**Version**: Flink 2.2.0

---

## Definition (Engineering Language)

**Confluent Cloud**: 提供 Kafka 和 Flink 作为托管服务的完全托管云平台。消除基础设施管理开销。

**Managed Kafka**: 由 Confluent 管理的 Kafka 集群，包括 brokers、Zookeeper 和 Schema Registry。

**Managed Flink**: 由 Confluent 管理的 Flink 计算集群，包括 JobManager、TaskManagers 和状态后端。

**CKU (Confluent Kafka Unit)**: Kafka 计算资源的度量单位。确定吞吐量和存储容量。

**CFU (Confluent Flink Unit)**: Flink 计算资源的度量单位。确定并行度和处理容量。

---

## Plain Language Explanation

将 Confluent Cloud 想象成数据库的 AWS RDS：

- **Confluent Cloud** = 托管服务："我们管理 Kafka 和 Flink，您只需使用它们"
- **CKU** = Kafka 计算单元："您需要多少 Kafka 容量"
- **CFU** = Flink 计算单元："您需要多少 Flink 处理能力"

**为什么需要**：MarketLag 使用 Confluent Cloud 进行生产部署，避免自托管基础设施。

---

## Analogy

如果您了解 **AWS 托管服务**（您了解），Confluent Cloud 类似：
- AWS RDS = Confluent Cloud Kafka（两者都是托管数据库/消息传递）
- AWS EMR = Confluent Cloud Flink（两者都是托管计算集群）

关键区别：Confluent Cloud 专注于流数据（Kafka + Flink 一起）。

---

## Relationship to Already Learned Topics

- **Kafka**: You already know Kafka - Confluent Cloud manages it
- **Flink**: You're learning Flink - Confluent Cloud manages it
- **Cloud Platforms**: You know AWS - Confluent Cloud is similar concept
- **6.2 Flink Environment**: Confluent Cloud provides Flink environments

---

## Confluent Cloud Architecture: Managed Kafka and Flink

### Components

1. **Kafka Clusters**: Managed Kafka brokers, automatically scaled
2. **Flink Environments**: Managed Flink clusters, ready for job deployment
3. **Schema Registry**: Managed schema registry for schema management
4. **Kafka Connect**: Managed connectors for data integration
5. **Monitoring**: Built-in metrics, dashboards, alerting

**MarketLag**: Uses Kafka clusters and Flink environments in Confluent Cloud.

---

## Confluent Cloud vs Self-Hosted: Differences and Benefits

### Managed (Confluent Cloud)

**优势**：
- **无需基础设施管理**：Confluent 处理服务器、更新、扩展
- **自动扩展**：根据负载自动扩展
- **高可用性**：内置冗余和故障转移
- **监控**：内置指标和仪表板
- **支持**：托管支持以解决问题

**成本**：按使用付费模式（CKU、CFU）

**MarketLag**: 使用 Confluent Cloud 以获得简单性和可靠性。

### Self-Hosted

**优势**：
- **完全控制**：完全控制基础设施
- **成本**：在规模上可能成本更低
- **自定义**：可以自定义配置

**缺点**：
- **基础设施管理**：需要管理服务器、更新、扩展
- **运营开销**：监控、故障排除、维护
- **需要专业知识**：需要 Kafka/Flink 专业知识

**MarketLag**: 选择 Confluent Cloud 以专注于应用程序逻辑，而不是基础设施。

---

## Confluent Cloud Pricing Model: CKU (Kafka), CFU (Flink)

### CKU (Confluent Kafka Unit)

**What it determines**:
- Kafka throughput (messages per second)
- Storage capacity
- Number of connections

**MarketLag**: Uses CKU for Kafka clusters (exact allocation depends on data volume).

### CFU (Confluent Flink Unit)

**What it determines**:
- Flink parallelism capacity
- Processing throughput
- State storage capacity

**MarketLag**: Uses **2 CFU for MVP** (provides 2 parallel subtasks).

### Pricing Structure

- **Pay-per-use**: Pay for CKU and CFU consumed
- **Scaling**: Scale up/down as needed
- **Cost Optimization**: Right-size resources based on load

**MarketLag**: 2 CFU for MVP, can scale up as data volume grows.

---

## Minimum Viable Code

Confluent Cloud is accessed through UI, CLI, or API (no code changes needed):

```bash
# CLI: Create Flink environment
confluent flink environment create \
    --name "marketlag-flink" \
    --region "us-east-1" \
    --cfu 2

# CLI: Create Kafka cluster
confluent kafka cluster create \
    --name "marketlag-kafka" \
    --region "us-east-1" \
    --cku 1
```

---

## Common Mistakes

1. **过度配置**：
   - ❌ 当 2 CFU 足够时从 10 CFU 开始
   - ✅ 从小规模开始，根据需要扩展（MarketLag 使用 2 CFU）

2. **不理解 CKU vs CFU**：
   - ❌ 混淆 Kafka 和 Flink 单元
   - ✅ 理解：CKU = Kafka 容量，CFU = Flink 容量

3. **忽略成本**：
   - ❌ 不监控成本
   - ✅ 监控 CKU/CFU 使用情况，设置计费警报

4. **不使用托管功能**：
   - ❌ 不使用 Schema Registry、监控
   - ✅ 使用托管功能以获得更好的体验

---

## Mind Trigger: When to Think About This

在以下情况下考虑 Confluent Cloud：
- **部署到生产环境**：MarketLag 使用 Confluent Cloud 进行生产
- **选择基础设施**：自托管 vs 托管决策
- **扩展资源**：理解 CKU 和 CFU 以进行扩展
- **成本规划**：理解定价模型以进行预算规划
- **设置环境**：第 6.2 节介绍 Flink environment 设置

**在 MarketLag 项目中**：使用 Confluent Cloud 进行托管 Kafka 和 Flink。MVP 使用 2 CFU。理解 Confluent Cloud 对于部署和操作至关重要。

---

## Summary

Confluent Cloud 提供托管 Kafka 和 Flink 服务，消除基础设施管理。CKU（Kafka）和 CFU（Flink）确定计算容量。MarketLag 使用 Confluent Cloud 进行生产部署，MVP 使用 2 CFU。理解 Confluent Cloud 对于部署和操作至关重要。

